# Server CONTRIBUTING 
## Introduction

The "My Assignments" project is split up between two applications: the Uploader
and the Server. The Server is a web application that allows students to view 
their stored assignment PDFs. This document will guide you on how to contribute
to the Server application. 

## Perquisite Knowledge

The Server is written in Java 8 and is not backwards compatible with any other 
Java versions. Because it is heavily relied upon in much of the server code: it
is recommended that you look up documentation on
[Java 8 functional programming](https://flyingbytes.github.io/programming/java8/functional/part1/2017/01/23/Java8-Part1.html).
Additionally, the Server also relies upon the 
[Spark micro-web Framework](http://sparkjava.com/) to service web requests, and
[JOOQ](https://www.jooq.org/) to handle database calls.

The design of the API for handling the upload of student assignments and 
related metadata is based off of 
[REST](http://www.restapitutorial.com/lessons/whatisrest.html), and, just like
the rest of the project, the overall architecture of the application is based 
off of 
[Model-View-Controller](https://blog.codinghorror.com/understanding-model-view-controller/).

## Architecture
The main entry point for the Server application is `era.server.ServerApp`. 
`ServerApp` first parses command line options passed to it (through the use of
era.server.common.ConfigOpts) and "starts up" the `ServerWebModule` and 
the `UploaderAPIModule`. 

The `ServerWebModule` sets up routes, using Spark's 
[HTTP verb methods](http://sparkjava.com/documentation#routes), to allow
students to use the Server web application. This includes viewing new  
assignments, logging in, and navigating through previous assignments. 
Controllers defined in `era.server.web` will handle requests for those routes.
We use [Handlebars.js](http://handlebarsjs.com/) for generating pages that 
students view.

The `UploaderAPIModule` sets up routes, using Spark's 
[HTTP verb methods](http://sparkjava.com/documentation#routes), to allow
the Uploader desktop application to communicate information to the Server. 
This information can include the assignments themselves as well as metadata 
about courses and students. Controllers defined in `era.server.api` will 
handle requests for those routes. 

`era.server.data.model` contains the Models used in this application. Models 
allow for storing domain specific information into a nice, tidy spot. Each 
model should implement the `era.server.data.model.Model` interface. This 
interface declares a method `#toViewModel` which allows the model to be used 
in Handlebar templates. 

`era.server.data.access` contains Data Access Objects (DAOs) that allow for 
the storage and retrieval of models stored in the my-assignments database. 

`era.server.data.database` contains classes generated by JOOQ. It should only 
be used by the `era.server.data.access` package.   

## Running the Server

NOTE: this project contains various configuration files that you will have to 
change please __DO NOT__ version these files with Git. 

Make sure you have a MariaDB database setup at port 3306. The database should 
be named `era`. Remember the root username and password for later usage. 

We use gradle to automate the build for the Server. Gradle needs to be 
configured to work properly in your specific environment. You can view 
configurations in the gradle.properties file. You will most likely need 
to change `db.user` and `db.password`. When running the Server for
the first time, you will to make sure that the Server's database schema is 
current. You can do this by running `gradle flywayMigrate`. Once you schema is 
up to date you can build the Server JAR using `gradle jar`. 

Once you have the JAR built you can run it using various command line arguments:

 * `--app-port`: the port the application should bind to
 * `--db-host`: the hostname of the node containing the database. 
 * `--db-port`: the port that the database is running on
 * `--db-user`: the name of the user the application should use to work with 
 the database
 * `--db-name`: the name of the database containing the my-assignments schema
 (usually era to match with the gradle build)
 * `--db-password`: the password for that user. 

## Routes

### Uploader API 

Each route belonging to the Uploader API is prefix with `/api/`. Routes are 
defined in the `UploaderAPIModule`. 

* `/api/course/:courseId/assignment` Creates an assignment. It takes in a POST
request with a Content-Type of `multipart/form-data`. It requires the custom 
headers of X-Assignment-Id (the id that the assignment will have when stored in
the database), X-Assignment-Name (the name of the assignment), X-Student-Id 
(the database id of the student who submitted the assignment), and 
X-Assignment-File-Name (the file name defining where the assignment should be 
stored at). `:courseId` is a request parameter that provides the database id 
for the course where the assignment was submitted to. The body should have a 
part with the name "pdf" that contains the actual assignment PDF file. 

* `/api/course/:courseId` Creates a course of students. It takes in a POST 
request with a Content-Type of `application/json`. The body should be a JSON 
list of `era.server.data.model.Course` objects. The `courseId` request 
parameter defines the database id of the course. The schema of the request is 
as follows:
```javascript 
[
    {
        "uniqueId", 
        "name", 
        "semester": {
            "uniqueId",
            "term", 
            "year"
        }, 
        "students": [
            {
                "userName", 
                "email", 
                "uniqueId"
        ]
    }
]
```

### Web pages
* `/hello` A health check page that should always respond "is it me you are 
looking for?". It just takes in a GET request with no parameters or headers. It
checks to make sure that the application can connect to the database.  